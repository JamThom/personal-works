<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JamThom</title>
  <meta name=viewport content="width=device-width,initial-scale=1">
  <style>
  body {
    font-family: monostena, monospace;
  }
  p {
    white-space: pre-wrap;
    margin: 10px 0 0;
  }
  a {
    display: block;
  }
  </style>
</head>
<body>
  <script>

    (function() {

      const texts = {
        hi: {
          tag: 'p',
          text: 'Hello World.'
        },
        myNameIs: {
          tag: 'p',
          text: 'My name is James Thomson.'
        },
        what: {
          tag: 'p',
          text: 'This is my personal creative site.'
        },
        info: {
          tag: 'p',
          text: 'Works:'
        },
        drumMachine: {
          tag: 'a',
          attributes: {
            href: 'https://html5drummachine.com',
            target: 'blank'
          },
          text: 'HTML5 Drum Machine (2014)'
        },
        electronium: {
          tag: 'a',
          attributes: {
            href: 'http://electronium.jamthom.io',
            target: 'blank'
          },
          text: 'Electronium (2016)'
        },
        dreamPipe: {
          tag: 'a',
          attributes: {
            href: 'https://dreampipe.fun',
            target: 'blank'
          },
          text: 'dreamPipe (2019)'
        },
        contact: {
          tag: 'p',
          text: 'Get in touch:'
        },
        email: {
          tag: 'a',
          attributes: {
            href: 'mailto:hello@jamthom.io',
            target: 'blank'
          },
          text: 'hello@jamthom.io'
        }
      };

      class TextElement {

        constructor({ tag, attributes, text }) {
          this.element = document.createElement(tag);
          document.body.append(this.element)
          this.setElementAttributes(attributes);
          this.text = text;
          this.animationFrame = 0;
        }

        setElementAttributes(attributes) {
          for (let attribute in attributes) {
            this.element.setAttribute(attribute,attributes[attribute]);
          }
        }

        updateText() {
          this.element.innerText = this.text.substring(0,this.animationFrame);
        }

        incrementAnimationFrame(next) {
          this.animationFrame++;
          this.updateText();
        }

        deccrementAnimationFrame(next) {
          this.animationFrame--;
          this.updateText();
        }

        generateAnimation(limit, callback, done) {
          const animation = () => {
            if (this.animationFrame === limit) return done();
            callback.bind(this)();
            requestAnimationFrame(animation);
          }
          animation()
        }

        animateInResolve(resolve) {
          this.generateAnimation(this.text.length,this.incrementAnimationFrame,resolve);
        }

        animateOutResolve(resolve) {
          this.generateAnimation(0,this.deccrementAnimationFrame,resolve);
        }

        animateIn() {
          return new Promise(this.animateInResolve.bind(this))
        }

        animateOut() {
          return new Promise(this.animateOutResolve.bind(this))
        }

      }

      class Animation {

        constructor(texts) {
          this.texts = {};
          for (let key in texts) {
            this.texts[key] = new TextElement(texts[key]);
          }
          this.beginAnimation();
        }

        async animateText(i) {
          if (i === this.textElements.length) return
          await this.textElements[i].animateIn();
          this.animateText(i+1);
        }

        animateTexts() {
          this.animateText(0);
        }

        delay(ms) {
          return new Promise((resolve) => {
            setTimeout(resolve,ms)
          })
        }

        async beginAnimation() {
          await this.texts.hi.animateIn();
          await this.texts.myNameIs.animateIn();
          await this.texts.what.animateIn();
          await this.texts.info.animateIn();
          await this.texts.drumMachine.animateIn();
          await this.texts.electronium.animateIn();
          await this.texts.dreamPipe.animateIn();
          await this.texts.contact.animateIn();
          await this.texts.email.animateIn();
        }

      }

      new Animation(texts);

    })();

  </script>
</body>
</html>
